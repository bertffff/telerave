# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ WatchParty Telegram

## üèóÔ∏è –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      Telegram Client                         ‚îÇ
‚îÇ                  (Mini App / Web View)                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚îÇ HTTPS + WebSocket
                         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      Cloudflare                              ‚îÇ
‚îÇ              (CDN, SSL, DDoS Protection)                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Nginx (Reverse Proxy)                     ‚îÇ
‚îÇ              - Route HTTP/WebSocket requests                 ‚îÇ
‚îÇ              - Static file serving                           ‚îÇ
‚îÇ              - Load balancing                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ                              ‚îÇ
           ‚îÇ HTTP                         ‚îÇ WebSocket
           ‚îÇ                              ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  React Frontend        ‚îÇ    ‚îÇ    Node.js Backend           ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ     ‚îÇ    ‚îÇ    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ        ‚îÇ
‚îÇ  - Vite bundler        ‚îÇ    ‚îÇ    - Express.js              ‚îÇ
‚îÇ  - React 18            ‚îÇ    ‚îÇ    - Socket.io server        ‚îÇ
‚îÇ  - Zustand (state)     ‚îÇ    ‚îÇ    - JWT auth                ‚îÇ
‚îÇ  - React Query         ‚îÇ    ‚îÇ    - Rate limiting           ‚îÇ
‚îÇ  - Socket.io client    ‚îÇ    ‚îÇ    - API routes              ‚îÇ
‚îÇ  - React Player        ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ         ‚îÇ
                                     ‚îÇ         ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ                                           ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ   PostgreSQL        ‚îÇ                   ‚îÇ      Redis          ‚îÇ
         ‚îÇ   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ     ‚îÇ                   ‚îÇ      ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ         ‚îÇ
         ‚îÇ   - Users           ‚îÇ                   ‚îÇ      - Sessions     ‚îÇ
         ‚îÇ   - Rooms           ‚îÇ                   ‚îÇ      - Cache        ‚îÇ
         ‚îÇ   - Messages        ‚îÇ                   ‚îÇ      - Pub/Sub      ‚îÇ
         ‚îÇ   - Statistics      ‚îÇ                   ‚îÇ      - Rate limits  ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
```
1. User –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Mini App –≤ Telegram
2. Telegram –ø–µ—Ä–µ–¥–∞–µ—Ç initData (–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
3. Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç initData –Ω–∞ /api/auth/telegram
4. Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å –∏—Å–ø–æ–ª—å–∑—É—è BOT_TOKEN
5. Backend —Å–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
6. Backend –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT —Ç–æ–∫–µ–Ω
7. Frontend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
```

### –°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ
```
1. User —Å–æ–∑–¥–∞–µ—Ç –∫–æ–º–Ω–∞—Ç—É —á–µ—Ä–µ–∑ UI
2. POST /api/rooms -> Backend —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î
3. User –ø–æ–ª—É—á–∞–µ—Ç room ID
4. User –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (—Å JWT –≤ auth)
5. User –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ 'room:join' —Å room ID
6. Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞, –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ participants
7. Backend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
8. Backend broadcast –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º
```

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤–∏–¥–µ–æ
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Host    ‚îÇ              ‚îÇ  Server  ‚îÇ              ‚îÇParticipant‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ play()                  ‚îÇ                         ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                         ‚îÇ
     ‚îÇ                         ‚îÇ video:state_changed     ‚îÇ
     ‚îÇ                         ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
     ‚îÇ                         ‚îÇ                         ‚îÇ
     ‚îÇ                         ‚îÇ                         ‚îÇ play()
     ‚îÇ                         ‚îÇ                         ‚îÇ
     ‚îÇ seek(120)               ‚îÇ                         ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                         ‚îÇ
     ‚îÇ                         ‚îÇ video:state_changed     ‚îÇ
     ‚îÇ                         ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
     ‚îÇ                         ‚îÇ                         ‚îÇ
     ‚îÇ                         ‚îÇ                         ‚îÇ seek(120)
```

## üíæ –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

### Users
```sql
- id: UUID (PK)
- telegram_id: BIGINT (UNIQUE)
- username: VARCHAR
- first_name: VARCHAR
- last_name: VARCHAR
- photo_url: TEXT
- created_at: TIMESTAMP
- last_active: TIMESTAMP
```

### Rooms
```sql
- id: UUID (PK)
- name: VARCHAR
- host_id: UUID (FK -> users)
- video_url: TEXT
- video_platform: VARCHAR
- current_time: FLOAT
- is_playing: BOOLEAN
- max_participants: INTEGER
- is_public: BOOLEAN
- password: VARCHAR (hashed)
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
```

### Room_Participants
```sql
- room_id: UUID (PK, FK -> rooms)
- user_id: UUID (PK, FK -> users)
- joined_at: TIMESTAMP
- is_voice_enabled: BOOLEAN
- role: VARCHAR (host/moderator/participant)
```

### Messages
```sql
- id: UUID (PK)
- room_id: UUID (FK -> rooms)
- user_id: UUID (FK -> users)
- content: TEXT
- type: VARCHAR (text/system/emoji)
- created_at: TIMESTAMP
```

### User_Stats
```sql
- user_id: UUID (PK, FK -> users)
- total_watch_time: INTEGER
- rooms_created: INTEGER
- rooms_joined: INTEGER
- messages_sent: INTEGER
- achievements: TEXT[]
- updated_at: TIMESTAMP
```

## üîå WebSocket —Å–æ–±—ã—Ç–∏—è

### Client -> Server
- `room:join` - –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ
- `room:leave` - –ü–æ–∫–∏–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É
- `video:play` - –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –≤–∏–¥–µ–æ (—Ç–æ–ª—å–∫–æ host)
- `video:pause` - –ü–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –ø–∞—É–∑—É (—Ç–æ–ª—å–∫–æ host)
- `video:seek` - –ü–µ—Ä–µ–º–æ—Ç–∞—Ç—å –≤–∏–¥–µ–æ (—Ç–æ–ª—å–∫–æ host)
- `video:change` - –°–º–µ–Ω–∏—Ç—å –≤–∏–¥–µ–æ (—Ç–æ–ª—å–∫–æ host)
- `chat:message` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
- `voice:toggle` - –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–π —á–∞—Ç

### Server -> Client
- `room:update` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã
- `room:participants` - –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- `chat:new_message` - –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ
- `video:state_changed` - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–∏–¥–µ–æ
- `error` - –û—à–∏–±–∫–∞

## üéØ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### Backend
1. **Connection Pooling**: PostgreSQL pool —Å max 20 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
2. **Redis Caching**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. **Rate Limiting**: 
   - API: 100 req/15min
   - Room Creation: 10 rooms/hour
   - Messages: 30 msg/min
4. **Automatic Cleanup**:
   - –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã: –∫–∞–∂–¥—ã–π —á–∞—Å
   - –°—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è: –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
5. **WebSocket Optimization**:
   - Throttling video updates (1 —Ä–∞–∑ –≤ 2 —Å–µ–∫)
   - Connection timeout: 60s
   - Ping interval: 25s

### Frontend
1. **Code Splitting**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ chunks –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
2. **Lazy Loading**: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é
3. **React Query**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–æ–≤
4. **Zustand**: –õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π state management
5. **Video Player**: ReactPlayer —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º

### Database
1. **Indexes**: –ù–∞ –≤—Å–µ FK –∏ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ –ø–æ–ª—è
2. **Automatic vacuum**: –î–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. **Prepared Statements**: –ó–∞—â–∏—Ç–∞ –æ—Ç SQL injection
4. **Triggers**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ timestamps

### Infrastructure
1. **Nginx**: Reverse proxy, gzip compression, static caching
2. **Docker**: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –ª–µ–≥–∫–æ–≥–æ –¥–µ–ø–ª–æ—è
3. **Cloudflare**: CDN, DDoS protection, SSL
4. **Redis**: Pub/Sub –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è WebSocket

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- JWT —Ç–æ–∫–µ–Ω—ã —Å 30-–¥–Ω–µ–≤–Ω—ã–º —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram Web App –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ HMAC-SHA256
- Secure HTTP-only cookies (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### API Security
- Helmet.js –¥–ª—è security headers
- CORS —Å whitelist
- Rate limiting –Ω–∞ –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö
- Input validation —Å Joi
- SQL injection protection (parameterized queries)

### WebSocket Security
- –¢–æ–∫–µ–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è (host/participant)
- Timeout –Ω–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- Message size limits

### Data Protection
- Passwords —Ö–µ—à–∏—Ä—É—é—Ç—Å—è —Å bcrypt
- Sensitive data –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è
- HTTPS everywhere (—á–µ—Ä–µ–∑ Cloudflare)
- XSS protection

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ (–≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)
1. –£–≤–µ–ª–∏—á–∏—Ç—å RAM –¥–ª—è Redis –∫—ç—à–∞
2. –£–≤–µ–ª–∏—á–∏—Ç—å PostgreSQL shared_buffers
3. –£–≤–µ–ª–∏—á–∏—Ç—å max_connections

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤)
1. **Load Balancer**: Nginx –∏–ª–∏ Cloudflare
2. **Multiple Backend Instances**: 
   - Redis Pub/Sub –¥–ª—è WebSocket events
   - Sticky sessions –¥–ª—è WebSocket
3. **Managed Database**: PostgreSQL cluster
4. **Managed Redis**: Redis Cluster
5. **CDN**: Cloudflare –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏

### Bottlenecks –∏ —Ä–µ—à–µ–Ω–∏—è
- **WebSocket connections**: Redis Adapter –¥–ª—è Socket.io
- **Database queries**: Read replicas
- **Video traffic**: CDN –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- **Memory**: Managed Redis
- **CPU**: Horizontal scaling

## üé® Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
App
‚îú‚îÄ‚îÄ AuthProvider (Telegram Web App init)
‚îú‚îÄ‚îÄ Router
‚îÇ   ‚îú‚îÄ‚îÄ Home (—Å–ø–∏—Å–æ–∫ –∫–æ–º–Ω–∞—Ç)
‚îÇ   ‚îú‚îÄ‚îÄ CreateRoom (—Ñ–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è)
‚îÇ   ‚îî‚îÄ‚îÄ Room (–≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ–º–Ω–∞—Ç—ã)
‚îÇ       ‚îú‚îÄ‚îÄ VideoPlayer
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ YouTubePlayer
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ TwitchPlayer
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ CustomPlayer
‚îÇ       ‚îú‚îÄ‚îÄ Chat
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ MessageList
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ MessageInput
‚îÇ       ‚îú‚îÄ‚îÄ VoiceChat (WebRTC)
‚îÇ       ‚îú‚îÄ‚îÄ ParticipantsList
‚îÇ       ‚îî‚îÄ‚îÄ Controls
‚îî‚îÄ‚îÄ SocketProvider (WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ)
```

## üåê –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∏–¥–µ–æ–ø–ª–∞—Ç—Ñ–æ—Ä–º

### YouTube
- React Player —Å YouTube API
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤
- Embedded player controls

### Twitch
- Twitch Embedded Player
- Live streams –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- Chat –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### Custom/Iframe
- –õ—é–±—ã–µ URL —Å embed –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
- Direct video files (mp4, webm)
- HLS streams

### –ö–∏–Ω–æ–ø–æ–∏—Å–∫ –∏ –¥—Ä—É–≥–∏–µ
- Iframe embedding
- URL validation
- Cross-origin handling

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Metrics
- Active connections (WebSocket)
- Room count
- User count
- Message rate
- API response times
- Database connection pool usage
- Redis memory usage

### Logging
- Winston –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ª–æ–≥–æ–≤
- –£—Ä–æ–≤–Ω–∏: error, warn, info, debug
- Rotation –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–º
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### Health Checks
- `/api/health` endpoint
- Database connection check
- Redis connection check
- WebSocket status

## üîÑ CI/CD (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

1. **Git Workflow**: 
   - main (production)
   - develop (staging)
   - feature/* branches

2. **Automated Testing**:
   - Unit tests (Jest)
   - Integration tests
   - E2E tests (Playwright)

3. **Deployment**:
   - GitHub Actions / GitLab CI
   - Automated Docker builds
   - Blue-green deployment
   - Rollback capability

4. **Monitoring**:
   - Uptime monitoring
   - Error tracking (Sentry)
   - Performance monitoring
   - User analytics
